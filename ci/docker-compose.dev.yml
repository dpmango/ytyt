version: '3.7'

networks:
  default:
    internal: true
  traefik:
    external:
      name: traefik
  services:
    external:
      name: services


services:
  backend:
    networks:
      - traefik
      - services
      - default
    expose:
      - 8000
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik
      - traefik.http.routers.${COMPOSE_PROJECT_NAME}_backend.rule=Host(`${DOMAIN}`) && (PathPrefix(`/api`) || PathPrefix(`/rest-auth`) || PathPrefix(`/media`) || PathPrefix(`/static`))
      - traefik.http.routers.${COMPOSE_PROJECT_NAME}_backend.tls=true
      - traefik.http.routers.${COMPOSE_PROJECT_NAME}_backend.tls.certresolver=le
